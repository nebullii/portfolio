---
import Card from "./Card/index.astro";
---

<Card colSpan="col-span-2" rowSpan="row-span-1">
  <div class="flex flex-col h-full">
    <h3 class="text-xl font-serif text-neutral-200 mb-2">GitHub Contributions</h3>
    <div class="flex-grow">
      <img
        src={`https://ghchart.rshah.org/nehachaudhari2811`}
        alt="Neha Chaudhari's GitHub Contributions Graph"
        class="w-full h-full object-cover rounded"
      />
    </div>
  </div>
</Card>

<script>
  // Function to fetch GitHub contributions
  async function fetchGitHubContributions() {
    try {
      const response = await fetch('https://api.github.com/graphql', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${import.meta.env.GITHUB_TOKEN}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          query: `
            query {
              viewer {
                contributionsCollection {
                  contributionCalendar {
                    totalContributions
                    weeks {
                      contributionDays {
                        contributionCount
                        date
                      }
                    }
                  }
                }
              }
            }
          `
        })
      });

      const data = await response.json();
      const contributions = data.data.viewer.contributionsCollection.contributionCalendar;
      
      // Display total contributions
      const container = document.getElementById('github-contributions');
      container.innerHTML = `
        <p class="text-xs text-neutral-400">
          Total contributions in the last year: ${contributions.totalContributions}
        </p>
        <div class="mt-2 grid grid-cols-7 gap-1">
          ${contributions.weeks.slice(-4).map(week => 
            week.contributionDays.map(day => `
              <div class="w-3 h-3 rounded-sm ${
                day.contributionCount > 0 
                  ? 'bg-green-500' 
                  : 'bg-neutral-800'
              }" title="${day.date}: ${day.contributionCount} contributions"></div>
            `).join('')
          ).join('')}
        </div>
      `;
    } catch (error) {
      console.error('Error fetching GitHub contributions:', error);
    }
  }

  // Call the function when the component loads
  fetchGitHubContributions();
</script> 